<!DOCTYPE html>
<html>
<head>

<meta charset="utf-8" />
<title>Musicity</title>
<meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
<script src="https://api.mapbox.com/mapbox-gl-js/v1.10.1/mapbox-gl.js"></script>
<link href="https://api.mapbox.com/mapbox-gl-js/v1.10.1/mapbox-gl.css" rel="stylesheet" />
<style>
	body { margin: 0; padding: 0; }
	#map {  position: absolute; left: 10%; top: 10%; bottom: 10%; width: 80%; }
</style>
</head>

<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/3/w3.css">
<body>

	<audio id="myAudio">

		<source src="idol.mp3" type="audio/mpeg">

	</audio>
	<audio id="myAudio3">

		<source src="picky.mp3" type="audio/mpeg">

	</audio>

	<audio id="backGround">

	  <source src="street-noises.mp3" type="audio/mpeg">

	</audio>





<script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.5.1/mapbox-gl-geocoder.min.js"></script>
<link
    rel="stylesheet"
    href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.5.1/mapbox-gl-geocoder.css"
    type="text/css"
/>
<!-- Promise polyfill script required to use Mapbox GL Geocoder in IE 11 -->
<script src="https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.auto.min.js"></script>
<div id="map"></div>

<script>


var pick = document.getElementById("myAudio");

// map ------------------
var a = -0.0804;
var b = 51.4738;
var a1 = -0.0804;
var b1 = 51.47405;
var a2 = -0.0804;
var b2 = 51.47405;
var a3 = -0.0824;
var b3 = 51.47327;
var a4 = -0.0826;
var b4 = 51.47435;
var a5 = -0.0807;
var b5 = 51.47425;
var a6 = -0.0802;
var b6 = 51.47455;

var z1;
var z3;
	mapboxgl.accessToken = 'pk.eyJ1IjoieGlhbmdzb25nIiwiYSI6ImNrYWNiMmc3YTFlbGkydnF3aWl1d2w5b2IifQ._glp69RcYfLoQ6guVxvtzA';
    var map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/dark-v10',
        center: [-0.0804, 51.4738],
				zoom: 19.3,
				pitch: 60,
				bearing: 90,
				container: 'map',
				antialias: true,
				pitchWithRotate: true,
				interactive: true,
    });

		var radius = 100;

    function pointOnCircle(angle) {
        return {
            'type': 'Point',
            'coordinates': [a, b]
        };
    }

		var deltaDistance = 150;



		function easing(t) {
				return t ;
		}

		map.on('load', function() {

			map.addSource('point', {
					'type': 'geojson',
					'data': pointOnCircle(0)
			});

			map.addLayer({
					'id': 'point',
					'source': 'point',
					'type': 'circle',
					'paint': {
							'circle-radius': 10,
							'circle-color': '#007cbf'
					}
			});





			map.loadImage(
					'https://upload.wikimedia.org/wikipedia/commons/7/7c/201408_cat.png',
					function(error, image) {


							if (error) throw error;
							map.addImage('cat', image);
							map.addSource('catpoints', {
									'type': 'geojson',
									'data': {
											'type': 'FeatureCollection',
											'features': [
													{
															'type': 'Feature',
															'properties': {
																	'description':
																			'<strong>Make it Mount Pleasant</strong><p><a href="http://www.mtpleasantdc.com/makeitmtpleasant" target="_blank" title="Opens in a new window">Make it Mount Pleasant</a> is a handmade and vintage market and afternoon of live entertainment and kids activities. 12:00-6:00 p.m.</p>',
																	'icon': 'theatre'
															},
															'geometry': {
																	'type': 'Point',
																	'coordinates': [a1, b1]
															}
													}
											]
									}
							});
							map.addLayer({
									'id': 'points',
									'type': 'symbol',
									'source': 'catpoints',
									'layout': {
											'icon-image': 'cat',
											'icon-size': 0.25
									}
							});


					}
			);
			map.loadImage(
					'https://raw.githubusercontent.com/xiangsong-yang/Musicity/master/musicity.png',
					function(error, image) {


							if (error) throw error;
							map.addImage('op', image);
							map.addSource('oppoints', {
									'type': 'geojson',
									'data': {
											'type': 'FeatureCollection',
											'features': [
													{
															'type': 'Feature',
															'properties': {
																	'description':
																			'<strong>Make it Mount Pleasant</strong><p><a href="http://www.mtpleasantdc.com/makeitmtpleasant" target="_blank" title="Opens in a new window">Make it Mount Pleasant</a> is a handmade and vintage market and afternoon of live entertainment and kids activities. 12:00-6:00 p.m.</p>',
																	'icon': 'theatre'
															},
															'geometry': {
																	'type': 'Point',
																	'coordinates': [a3, b3]
															}
													}
											]
									}
							});
							map.addLayer({
									'id': 'oppoints',
									'type': 'symbol',
									'source': 'oppoints',
									'layout': {
											'icon-image': 'op',
											'icon-size': 0.15
									}
							});


					}
			);





			map.getCanvas().focus();

			map.getCanvas().addEventListener(

					'keydown',
					function(e) {

							e.preventDefault();
							if (e.which === 87) {
									// up
								//	map.panBy([0, -deltaDistance], {
								//			easing: easing});
									a = a+0.000000198*deltaDistance;



							} else if (e.which === 83) {
									// down
							//		map.panBy([0, deltaDistance], {
							//				easing: easing
							//		});
									a = a-0.000000198*deltaDistance;

							} else if (e.which === 65) {
									// left
								//	map.panBy([-deltaDistance, 0], {
							//				easing: easing
							//		});
									b = b+0.000000198*deltaDistance;

							} else if (e.which === 68) {
									// right
							//		map.panBy([deltaDistance, 0], {
						//					easing: easing
						//			});
									b = b-0.000000198*deltaDistance;

							}

//
z1 = Math.sqrt(( a - a1)*(a - a1) + (b - b1)*(b - b1 ));
z3 = Math.sqrt(( a - a3)*(a - a3) + (b - b3)*(b - b3 ));

document.getElementById("myAudio").volume = 0.6-3000.0*z1;
//document.getElementById("myAudio3").volume = 0.6-3000.0*z3;

if(document.getElementById("myAudio").volume<0.071){
	document.getElementById("myAudio").pause();
}else{
	document.getElementById("myAudio").play();
}




					},
					true

			);
		// Insert the layer beneath any symbol layer.
		var layers = map.getStyle().layers;

		var deltaDistance = 100;


		var labelLayerId;
		for (var i = 0; i < layers.length; i++) {
		if (layers[i].type === 'symbol' && layers[i].layout['text-field']) {
		labelLayerId = layers[i].id;
		break;
		}
		}

		map.addLayer(
		{
		'id': '3d-buildings',
		'source': 'composite',
		'source-layer': 'building',
		'filter': ['==', 'extrude', 'true'],
		'type': 'fill-extrusion',
		'minzoom': 15,
		'paint': {
		'fill-extrusion-color': '#aaa',

		// use an 'interpolate' expression to add a smooth transition effect to the
		// buildings as the user zooms in
		'fill-extrusion-height': [
		'interpolate',
		['linear'],
		['zoom'],
		15,
		0,
		15.05,
		['get', 'height']
		],
		'fill-extrusion-base': [
		'interpolate',
		['linear'],
		['zoom'],
		15,
		0,
		15.05,
		['get', 'min_height']
		],
		'fill-extrusion-opacity': 0.6
		}
		},
		labelLayerId
		);
		function animateMarker(timestamp) {
				// Update the data to a new position based on the animation timestamp. The
				// divisor in the expression `timestamp / 1000` controls the animation speed.
				map.getSource('point').setData(pointOnCircle(timestamp / 1000));

				// Request the next frame of the animation.
				requestAnimationFrame(animateMarker);
		}
		function play(){

			document.getElementById("myAudio").play();
		//	document.getElementById("myAudio3").play();
			document.getElementById("backGround").play();
			document.getElementById("backGround").loop=true;
			document.getElementById("backGround").volume = 0.01;

			document.getElementById("myAudio").loop=true;
			document.getElementById("myAudio").volume = 0.0;
			//document.getElementById("myAudio3").loop=true;
		  //document.getElementById("myAudio3").volume = 0.0;


		}
		animateMarker(0);
		play();

		map.addSource('places', {
				'type': 'geojson',
				'data': {
						'type': 'FeatureCollection',
						'features': [
								{
										'type': 'Feature',
										'properties': {
												'description':
														'<strong>UAL Camberwell CCI </strong><p><a href="https://www.arts.ac.uk/creative-computing-institute" target="_blank" title="Opens in a new window">Creative computing institute </a> is a stunning place to go! Xiangsong plays bass here!  </p>',
												'icon': 'theatre'
										},
										'geometry': {
												'type': 'Point',
												'coordinates': [a2, b2]
										}
								},
								{
										'type': 'Feature',
										'properties': {
												'description':
														'<strong>Musicity </strong><p>This is where Xiangsong got locked down. A bunker, a studio....</p>',
												'icon': 'theatre'
										},
										'geometry': {
												'type': 'Point',
												'coordinates': [a3, b3]
										}
								},


						]
				}
		});
		// Add a layer showing the places.
		map.addLayer({
				'id': 'places',
				'type': 'symbol',
				'source': 'places',
				'layout': {
						'icon-image': '{icon}-15',
						'icon-allow-overlap': true,
						'icon-size': 1.25
				}
		});

		// When a click event occurs on a feature in the places layer, open a popup at the
		// location of the feature, with description HTML from its properties.
		map.on('click', 'places', function(e) {
				var coordinates = e.features[0].geometry.coordinates.slice();
				var description = e.features[0].properties.description;

				// Ensure that if the map is zoomed out such that multiple
				// copies of the feature are visible, the popup appears
				// over the copy being pointed to.
				while (Math.abs(e.lngLat.lng - coordinates[0]) > 180) {
						coordinates[0] += e.lngLat.lng > coordinates[0] ? 360 : -360;
				}

				new mapboxgl.Popup()
						.setLngLat(coordinates)
						.setHTML(description)
						.addTo(map);
		});

		// Change the cursor to a pointer when the mouse is over the places layer.
		map.on('mouseenter', 'places', function() {
				map.getCanvas().style.cursor = 'pointer';
		});

		// Change it back to a pointer when it leaves.
		map.on('mouseleave', 'places', function() {
				map.getCanvas().style.cursor = '';
		});
		});

    var customData = {
        'features': [
            {
                'type': 'Feature',
                'properties': {
                    'title': 'Lincoln Park',
                    'description':
                        'A northside park that is home to the Lincoln Park Zoo'
                },
                'geometry': {
                    'coordinates': [-87.637596, 41.940403],
                    'type': 'Point'
                }
            },
            {
                'type': 'Feature',
                'properties': {
                    'title': 'Burnham Park',
                    'description': "A lakefront park on Chicago's south side"
                },
                'geometry': {
                    'coordinates': [-87.603735, 41.829985],
                    'type': 'Point'
                }
            },
            {
                'type': 'Feature',
                'properties': {
                    'title': 'Millennium Park',
                    'description':
                        'A downtown park known for its art installations and unique architecture'
                },
                'geometry': {
                    'coordinates': [-87.622554, 41.882534],
                    'type': 'Point'
                }
            },
            {
                'type': 'Feature',
                'properties': {
                    'title': 'Grant Park',
                    'description':
                        "A downtown park that is the site of many of Chicago's favorite festivals and events"
                },
                'geometry': {
                    'coordinates': [-87.619185, 41.876367],
                    'type': 'Point'
                }
            },
            {
                'type': 'Feature',
                'properties': {
                    'title': 'Humboldt Park',
                    'description': "A large park on Chicago's northwest side"
                },
                'geometry': {
                    'coordinates': [-87.70199, 41.905423],
                    'type': 'Point'
                }
            },
            {
                'type': 'Feature',
                'properties': {
                    'title': 'Douglas Park',
                    'description':
                        "A large park near in Chicago's North Lawndale neighborhood"
                },
                'geometry': {
                    'coordinates': [-87.699329, 41.860092],
                    'type': 'Point'
                }
            },
            {
                'type': 'Feature',
                'properties': {
                    'title': 'Calumet Park',
                    'description':
                        'A park on the Illinois-Indiana border featuring a historic fieldhouse'
                },
                'geometry': {
                    'coordinates': [-87.530221, 41.715515],
                    'type': 'Point'
                }
            },
            {
                'type': 'Feature',
                'properties': {
                    'title': 'Jackson Park',
                    'description':
                        "A lakeside park that was the site of the 1893 World's Fair"
                },
                'geometry': {
                    'coordinates': [-87.580389, 41.783185],
                    'type': 'Point'
                }
            },
            {
                'type': 'Feature',
                'properties': {
                    'title': 'Columbus Park',
                    'description':
                        "A large park in Chicago's Austin neighborhood"
                },
                'geometry': {
                    'coordinates': [-87.769775, 41.873683],
                    'type': 'Point'
                }
            }
        ],
        'type': 'FeatureCollection'
    };

    function forwardGeocoder(query) {
        var matchingFeatures = [];
        for (var i = 0; i < customData.features.length; i++) {
            var feature = customData.features[i];
            // handle queries with different capitalization than the source data by calling toLowerCase()
            if (
                feature.properties.title
                    .toLowerCase()
                    .search(query.toLowerCase()) !== -1
            ) {
                // add a tree emoji as a prefix for custom data results
                // using carmen geojson format: https://github.com/mapbox/carmen/blob/master/carmen-geojson.md
                feature['place_name'] = 'ðŸŒ² ' + feature.properties.title;
                feature['center'] = feature.geometry.coordinates;
                feature['place_type'] = ['park'];
                matchingFeatures.push(feature);
            }
        }
        return matchingFeatures;
    }








</script>

</body>
</html>
